



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="ApiMeter User Documentation">
      
      
      
        <meta name="author" content="debugtalk">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-3.3.0">
    
    
      
        <title>全局变量完整指南 - ApiMeter Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114587036-2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-114587036-2")</script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="ApiMeter Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ApiMeter Docs
              </span>
              <span class="md-header-nav__topic">
                全局变量完整指南
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://git.umlife.net/utils/apimeter" title="前往 Github 仓库" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      ApiMeter
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="ApiMeter Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    ApiMeter Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://git.umlife.net/utils/apimeter" title="前往 Github 仓库" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      ApiMeter
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="介绍" class="md-nav__link">
      介绍
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Installation/" title="安装说明" class="md-nav__link">
      安装说明
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      基础概念
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        基础概念
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../concept/nominal/" title="名词解释" class="md-nav__link">
      名词解释
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      测试准备
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        测试准备
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/record/" title="录制生成用例" class="md-nav__link">
      录制生成用例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/project-structure/" title="项目文件组织" class="md-nav__link">
      项目文件组织
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/testcase-structure/" title="测试用例组织" class="md-nav__link">
      测试用例组织
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/request-hook/" title="hook机制" class="md-nav__link">
      hook机制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/dot-env/" title="环境变量" class="md-nav__link">
      环境变量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/testcase-layer/" title="测试用例分层" class="md-nav__link">
      测试用例分层
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/parameters/" title="参数化数据驱动" class="md-nav__link">
      参数化数据驱动
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/validate/" title="校验器用法" class="md-nav__link">
      校验器用法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/script/" title="自定义脚本校验" class="md-nav__link">
      自定义脚本校验
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/pretty/" title="用例格式化" class="md-nav__link">
      用例格式化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/yaml-issue/" title="常见格式问题" class="md-nav__link">
      常见格式问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/security/" title="信息安全" class="md-nav__link">
      信息安全
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../prepare/upload-case/" title="文件上传场景" class="md-nav__link">
      文件上传场景
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      测试执行
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        测试执行
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../run-tests/cli/" title="运行测试(CLI)" class="md-nav__link">
      运行测试(CLI)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../run-tests/report/" title="测试报告" class="md-nav__link">
      测试报告
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../run-tests/load-test/" title="性能测试" class="md-nav__link">
      性能测试
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      开发扩展
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        开发扩展
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/architecture/" title="代码框架" class="md-nav__link">
      代码框架
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/dev-api/" title="开发扩展" class="md-nav__link">
      开发扩展
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../FAQ/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      实践案例
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        实践案例
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/quickstart-case/" title="快速上手案例" class="md-nav__link">
      快速上手案例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/testerhome-login/" title="TesterHome 登录" class="md-nav__link">
      TesterHome 登录
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/demo-klook/" title="klook" class="md-nav__link">
      klook
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../related-docs/" title="相关资料" class="md-nav__link">
      相关资料
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../CHANGELOG/" title="CHANGELOG" class="md-nav__link">
      CHANGELOG
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="📚 目录" class="md-nav__link">
    📚 目录
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="什么是全局变量？" class="md-nav__link">
    什么是全局变量？
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="可用的全局变量列表" class="md-nav__link">
    可用的全局变量列表
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" title="📊 响应状态相关" class="md-nav__link">
    📊 响应状态相关
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-status_code" title="1. status_code" class="md-nav__link">
    1. status_code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ok" title="2. ok" class="md-nav__link">
    2. ok
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-reason" title="3. reason" class="md-nav__link">
    3. reason
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-url" title="4. url" class="md-nav__link">
    4. url
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="📦 响应体相关" class="md-nav__link">
    📦 响应体相关
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5-content" title="5. content" class="md-nav__link">
    5. content
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-body" title="6. body" class="md-nav__link">
    6. body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-json" title="7. json" class="md-nav__link">
    7. json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-text" title="8. text" class="md-nav__link">
    8. text
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="📋 响应头相关" class="md-nav__link">
    📋 响应头相关
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#9-headers" title="9. headers" class="md-nav__link">
    9. headers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-cookies" title="10. cookies" class="md-nav__link">
    10. cookies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="⏱️ 性能相关" class="md-nav__link">
    ⏱️ 性能相关
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-elapsed" title="11. elapsed" class="md-nav__link">
    11. elapsed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="🔧 编码相关" class="md-nav__link">
    🔧 编码相关
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#12-encoding" title="12. encoding" class="md-nav__link">
    12. encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="📡 完整响应对象" class="md-nav__link">
    📡 完整响应对象
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#13-response" title="13. response" class="md-nav__link">
    13. response
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" title="链式取值详解" class="md-nav__link">
    链式取值详解
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" title="什么是链式取值？" class="md-nav__link">
    什么是链式取值？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="基础链式取值" class="md-nav__link">
    基础链式取值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" title="数组索引访问" class="md-nav__link">
    数组索引访问
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" title="混合访问" class="md-nav__link">
    混合访问
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" title="链式取值的类型安全" class="md-nav__link">
    链式取值的类型安全
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" title="变量转义功能" class="md-nav__link">
    变量转义功能
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" title="为什么需要变量转义？" class="md-nav__link">
    为什么需要变量转义？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" title="转义语法" class="md-nav__link">
    转义语法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" title="支持转义的全局变量" class="md-nav__link">
    支持转义的全局变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" title="完整示例" class="md-nav__link">
    完整示例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vs" title="全局变量 vs 自定义变量" class="md-nav__link">
    全局变量 vs 自定义变量
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" title="全局变量" class="md-nav__link">
    全局变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" title="自定义变量" class="md-nav__link">
    自定义变量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" title="混合使用" class="md-nav__link">
    混合使用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" title="常见使用场景" class="md-nav__link">
    常见使用场景
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" title="场景 1：基础响应校验" class="md-nav__link">
    场景 1：基础响应校验
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" title="场景 2：性能监控" class="md-nav__link">
    场景 2：性能监控
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" title="场景 3：复杂数据校验" class="md-nav__link">
    场景 3：复杂数据校验
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" title="场景 4：条件校验" class="md-nav__link">
    场景 4：条件校验
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5api" title="场景 5：API 版本兼容" class="md-nav__link">
    场景 5：API 版本兼容
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_26" title="最佳实践" class="md-nav__link">
    最佳实践
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-content" title="1. 优先使用 content" class="md-nav__link">
    1. 优先使用 content
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" title="2. 链式取值前先检查存在性" class="md-nav__link">
    2. 链式取值前先检查存在性
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" title="3. 使用有意义的错误信息" class="md-nav__link">
    3. 使用有意义的错误信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" title="4. 性能校验要合理" class="md-nav__link">
    4. 性能校验要合理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" title="5. 变量转义谨慎使用" class="md-nav__link">
    5. 变量转义谨慎使用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" title="常见问题" class="md-nav__link">
    常见问题
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q1-contentfield-contentfield" title="Q1: 为什么 content.field 和 content["field"] 都可以？" class="md-nav__link">
    Q1: 为什么 content.field 和 content["field"] 都可以？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q2" title="Q2: 如何访问字段名包含点号或特殊字符的字段？" class="md-nav__link">
    Q2: 如何访问字段名包含点号或特殊字符的字段？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q3-contentbodyjson" title="Q3: content、body、json 有什么区别？" class="md-nav__link">
    Q3: content、body、json 有什么区别？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q4-json" title="Q4: 如何处理响应不是 JSON 格式的情况？" class="md-nav__link">
    Q4: 如何处理响应不是 JSON 格式的情况？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q5-validate" title="Q5: 全局变量在 validate 中可以使用吗？" class="md-nav__link">
    Q5: 全局变量在 validate 中可以使用吗？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q6" title="Q6: 如何在自定义函数中使用全局变量？" class="md-nav__link">
    Q6: 如何在自定义函数中使用全局变量？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" title="📝 总结" class="md-nav__link">
    📝 总结
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              

                
                
                <h1 id="_1">全局变量完整指南<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>ApiMeter 提供了强大的全局变量系统，让你可以在 <code>script</code> 脚本中直接访问响应数据，无需特殊语法。本文档详细介绍所有可用的全局变量及其高级用法。</p>
<h2 id="_2">📚 目录<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#什么是全局变量">什么是全局变量？</a></li>
<li><a href="#可用的全局变量列表">可用的全局变量列表</a></li>
<li><a href="#链式取值详解">链式取值详解</a></li>
<li><a href="#变量转义功能">变量转义功能</a></li>
<li><a href="#全局变量-vs-自定义变量">全局变量 vs 自定义变量</a></li>
<li><a href="#常见使用场景">常见使用场景</a></li>
<li><a href="#最佳实践">最佳实践</a></li>
<li><a href="#常见问题">常见问题</a></li>
</ul>
<h2 id="_3">什么是全局变量？<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><strong>全局变量</strong> 是 ApiMeter 在 <code>script</code> 脚本执行时自动注入的响应相关变量。你可以直接在脚本中使用这些变量，无需任何前缀或特殊语法。</p>
<p><strong>对比传统方式：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ❌ 传统 validate 方式</span>
<span class="nt">validate</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;status_code&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">200</span><span class="p p-Indicator">]</span><span class="w">           </span><span class="c1"># 需要用字符串表示</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;content.token&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;xxx&quot;</span><span class="p p-Indicator">]</span><span class="w">       </span><span class="c1"># 字段访问需要点号字符串</span>

<span class="c1"># ✅ ApiMeter script 方式</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code == 200</span><span class="w">          </span><span class="c1"># 直接使用变量</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.token == &quot;xxx&quot;</span><span class="w">      </span><span class="c1"># 支持对象属性访问</span>
</code></pre></div>

<h2 id="_4">可用的全局变量列表<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="_5">📊 响应状态相关<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<h4 id="1-status_code">1. <code>status_code</code><a class="headerlink" href="#1-status_code" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>int</code><br />
<strong>说明</strong>：HTTP 响应状态码</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code == 200</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code in [200, 201, 202]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert 200 &lt;= status_code &lt; 300, f&quot;期望2xx状态码，实际</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">status_code</span><span class="p p-Indicator">}</span><span class="s">&quot;</span>
</code></pre></div>

<hr />
<h4 id="2-ok">2. <code>ok</code><a class="headerlink" href="#2-ok" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>bool</code><br />
<strong>说明</strong>：请求是否成功（状态码 &lt; 400）</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert ok is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert ok is True, &quot;请求失败&quot;</span>

<span class="w">  </span><span class="c1"># 条件判断</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">if ok:</span>
<span class="w">        </span><span class="no">assert content.success is True</span>
<span class="w">    </span><span class="no">else:</span>
<span class="w">        </span><span class="no">assert content.error_code is not None</span>
</code></pre></div>

<hr />
<h4 id="3-reason">3. <code>reason</code><a class="headerlink" href="#3-reason" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>str</code><br />
<strong>说明</strong>：HTTP 状态码对应的原因短语</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert reason == &quot;OK&quot;</span><span class="w">              </span><span class="c1"># 200 OK</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert reason == &quot;Created&quot;</span><span class="w">         </span><span class="c1"># 201 Created</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert reason == &quot;Not Found&quot;</span><span class="w">       </span><span class="c1"># 404 Not Found</span>
</code></pre></div>

<hr />
<h4 id="4-url">4. <code>url</code><a class="headerlink" href="#4-url" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>str</code><br />
<strong>说明</strong>：实际请求的完整 URL（包含重定向后的 URL）</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert url.startswith(&quot;https://&quot;)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;api&quot; in url</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert url.endswith(&quot;/users/1001&quot;)</span>
</code></pre></div>

<hr />
<h3 id="_6">📦 响应体相关<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<h4 id="5-content">5. <code>content</code><a class="headerlink" href="#5-content" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>dict-like</code> （ResponseFieldProxy）<br />
<strong>说明</strong>：响应内容，自动解析 JSON（最常用）</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 基础访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.code == 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.message == &quot;success&quot;</span>

<span class="w">  </span><span class="c1"># 链式取值</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.user.name == &quot;Alice&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.user.profile.age &gt; 18</span>

<span class="w">  </span><span class="c1"># 数组访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(content.items) &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.items[0].id is not None</span>

<span class="w">  </span><span class="c1"># 字典访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;token&quot; in content</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content[&quot;token&quot;] is not None</span>
</code></pre></div>

<hr />
<h4 id="6-body">6. <code>body</code><a class="headerlink" href="#6-body" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>dict-like</code> （ResponseFieldProxy）<br />
<strong>说明</strong>：与 <code>content</code> 等价，原始响应体</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert body.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;token&quot; in body</span>
</code></pre></div>

<hr />
<h4 id="7-json">7. <code>json</code><a class="headerlink" href="#7-json" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>dict-like</code> （ResponseFieldProxy）<br />
<strong>说明</strong>：与 <code>content</code> 等价，JSON 响应内容</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert json.code == 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert json.data.user.name == &quot;Alice&quot;</span>
</code></pre></div>

<hr />
<h4 id="8-text">8. <code>text</code><a class="headerlink" href="#8-text" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>str</code><br />
<strong>说明</strong>：响应的文本内容（未解析的原始字符串）</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(text) &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;success&quot; in text</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert text.startswith(&quot;{&quot;)</span><span class="w">       </span><span class="c1"># JSON 响应</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert text.startswith(&quot;&lt;html&quot;)</span><span class="w">   </span><span class="c1"># HTML 响应</span>
</code></pre></div>

<hr />
<h3 id="_7">📋 响应头相关<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<h4 id="9-headers">9. <code>headers</code><a class="headerlink" href="#9-headers" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>dict-like</code><br />
<strong>说明</strong>：响应头信息</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 访问响应头</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers[&quot;Content-Type&quot;] == &quot;application/json&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;Server&quot; in headers</span>

<span class="w">  </span><span class="c1"># 大小写不敏感</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers[&quot;content-type&quot;] == &quot;application/json&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers[&quot;Content-Type&quot;] == headers[&quot;content-type&quot;]</span>

<span class="w">  </span><span class="c1"># 常见响应头检查</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;application/json&quot; in headers[&quot;Content-Type&quot;]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers.get(&quot;Cache-Control&quot;) is not None</span>
</code></pre></div>

<hr />
<h4 id="10-cookies">10. <code>cookies</code><a class="headerlink" href="#10-cookies" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>dict-like</code><br />
<strong>说明</strong>：Cookie 信息</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 检查 Cookie 是否存在</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;session_id&quot; in cookies</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert cookies[&quot;session_id&quot;] is not None</span>

<span class="w">  </span><span class="c1"># Cookie 值校验</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(cookies[&quot;session_id&quot;]) &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert cookies.get(&quot;user_id&quot;) is not None</span>
</code></pre></div>

<hr />
<h3 id="_8">⏱️ 性能相关<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<h4 id="11-elapsed">11. <code>elapsed</code><a class="headerlink" href="#11-elapsed" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>object</code> （timedelta）<br />
<strong>说明</strong>：请求响应时间对象</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 响应时间校验（秒）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert elapsed.total_seconds &lt; 2.0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert elapsed.total_seconds &lt; 1.0, f&quot;响应过慢</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">elapsed.total_seconds</span><span class="p p-Indicator">}</span><span class="l l-Scalar l-Scalar-Plain">秒&quot;</span>

<span class="w">  </span><span class="c1"># 毫秒级别</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert elapsed.total_seconds * 1000 &lt; 500</span><span class="w">  </span><span class="c1"># 500ms</span>

<span class="w">  </span><span class="c1"># 复杂条件</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">response_time = elapsed.total_seconds</span>
<span class="w">    </span><span class="no">if response_time &gt; 2.0:</span>
<span class="w">        </span><span class="no">print(f&quot;警告：响应时间过长 {response_time}秒&quot;)</span>
<span class="w">    </span><span class="no">assert response_time &lt; 5.0, &quot;响应超时&quot;</span>
</code></pre></div>

<hr />
<h3 id="_9">🔧 编码相关<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<h4 id="12-encoding">12. <code>encoding</code><a class="headerlink" href="#12-encoding" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>str</code> 或 <code>None</code><br />
<strong>说明</strong>：响应的字符编码</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert encoding == &quot;utf-8&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert encoding in [&quot;utf-8&quot;, &quot;UTF-8&quot;, None]</span>
</code></pre></div>

<hr />
<h3 id="_10">📡 完整响应对象<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<h4 id="13-response">13. <code>response</code><a class="headerlink" href="#13-response" title="Permanent link">&para;</a></h4>
<p><strong>类型</strong>：<code>Response</code> （requests.Response 对象）<br />
<strong>说明</strong>：完整的 requests Response 对象</p>
<p><strong>示例</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 访问所有 Response 属性</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert response.status_code == 200</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert response.ok is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert response.headers[&quot;Content-Type&quot;] == &quot;application/json&quot;</span>

<span class="w">  </span><span class="c1"># Response 对象方法</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert response.json()[&quot;success&quot;] is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(response.content) &gt; 0</span>
</code></pre></div>

<hr />
<h2 id="_11">链式取值详解<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="_12">什么是链式取值？<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>链式取值允许你使用点号 <code>.</code> 访问嵌套的数据结构，类似于 JavaScript 中的对象属性访问。</p>
<h3 id="_13">基础链式取值<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 一级访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user is not None</span>

<span class="w">  </span><span class="c1"># 二级访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user.name == &quot;Alice&quot;</span>

<span class="w">  </span><span class="c1"># 三级访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user.profile.age &gt; 18</span>

<span class="w">  </span><span class="c1"># 四级及更深</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.user.profile.contact.email == &quot;alice@example.com&quot;</span>
</code></pre></div>

<p><strong>对应的数据结构：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;contact&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="_14">数组索引访问<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 访问数组第一个元素</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.items[0].id is not None</span>

<span class="w">  </span><span class="c1"># 访问数组最后一个元素</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.items[-1].status == &quot;completed&quot;</span>

<span class="w">  </span><span class="c1"># 嵌套数组访问</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.users[0].orders[0].product_id == 123</span>
</code></pre></div>

<p><strong>对应的数据结构：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Item 1&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Item 2&quot;</span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;users&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;orders&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;product_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="_15">混合访问<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 对象 -&gt; 数组 -&gt; 对象 -&gt; 字段</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.users[0].profile.name == &quot;Alice&quot;</span>

<span class="w">  </span><span class="c1"># 数组 -&gt; 对象 -&gt; 数组 -&gt; 对象</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.orders[0].items[0].price &gt; 0</span>
</code></pre></div>

<h3 id="_16">链式取值的类型安全<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ✅ 推荐：先检查存在性</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user is not None</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user.name == &quot;Alice&quot;</span>

<span class="w">  </span><span class="c1"># ✅ 推荐：使用条件判断</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">if hasattr(content, &#39;user&#39;) and content.user:</span>
<span class="w">        </span><span class="no">assert content.user.name == &quot;Alice&quot;</span>

<span class="w">  </span><span class="c1"># ⚠️ 注意：直接访问可能报错</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.non_existent_field.name == &quot;Alice&quot;</span><span class="w">  </span><span class="c1"># AttributeError</span>
</code></pre></div>

<h2 id="_17">变量转义功能<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h2>
<h3 id="_18">为什么需要变量转义？<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>当响应数据中的字段名与全局变量同名时，会产生歧义。</p>
<p><strong>问题场景：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;这是内容&quot;</span><span class="p">,</span><span class="w">       </span><span class="c1">// 字段名叫 content</span>
<span class="w">    </span><span class="nt">&quot;status_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SUCCESS&quot;</span><span class="w">     </span><span class="c1">// 字段名叫 status_code</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>在自定义函数中：</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_field_exists</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
    <span class="c1"># 希望 field_name 是字符串 &quot;content&quot;</span>
    <span class="c1"># 但如果传递 content，会传递全局变量的值（整个响应体）</span>
    <span class="k">return</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">data</span>
</code></pre></div>

<h3 id="_19">转义语法<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>使用反斜杠 <code>\</code> 将全局变量转义为字面量字符串：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># content 是全局变量（整个响应体）</span>
<span class="w">  </span><span class="c1"># \content 是字符串 &quot;content&quot;（字段名）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${check_field_exists(data, \content)}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${check_field_exists(data, \status_code)}</span>
</code></pre></div>

<h3 id="_20">支持转义的全局变量<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>所有全局变量都可以转义：
- <code>\content</code> → 字符串 <code>"content"</code>
- <code>\body</code> → 字符串 <code>"body"</code>
- <code>\text</code> → 字符串 <code>"text"</code>
- <code>\json</code> → 字符串 <code>"json"</code>
- <code>\status_code</code> → 字符串 <code>"status_code"</code>
- <code>\headers</code> → 字符串 <code>"headers"</code>
- <code>\cookies</code> → 字符串 <code>"cookies"</code>
- <code>\encoding</code> → 字符串 <code>"encoding"</code>
- <code>\ok</code> → 字符串 <code>"ok"</code>
- <code>\reason</code> → 字符串 <code>"reason"</code>
- <code>\url</code> → 字符串 <code>"url"</code></p>
<h3 id="_21">完整示例<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p><strong>debugtalk.py：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_data_not_null</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">field_count</span><span class="p">,</span> <span class="n">field_prefix</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    检查数据字段不为空</span>

<span class="sd">    Args:</span>
<span class="sd">        data: 数据对象</span>
<span class="sd">        field_count: 字段数量</span>
<span class="sd">        field_prefix: 字段前缀</span>
<span class="sd">        field_name: 字段名（需要转义）</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 假设数据结构: {&quot;lines&quot;: &quot;...&quot;, &quot;content&quot;: &quot;...&quot;}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">field_count</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_prefix</span><span class="si">}{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing field: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># 检查特定字段</span>
    <span class="k">assert</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing field: </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>

<p><strong>测试用例：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># \content 转义为字符串 &quot;content&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${check_data_not_null(content.data.linesCollectList.data, 2, lines, \content)}</span>
</code></pre></div>

<h2 id="vs">全局变量 vs 自定义变量<a class="headerlink" href="#vs" title="Permanent link">&para;</a></h2>
<h3 id="_22">全局变量<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p><strong>定义</strong>：由 ApiMeter 自动注入的响应变量<br />
<strong>使用</strong>：直接使用，无需前缀</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 全局变量（无需 $ 前缀）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code == 200</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers[&quot;Content-Type&quot;] == &quot;application/json&quot;</span>
</code></pre></div>

<h3 id="_23">自定义变量<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p><strong>定义</strong>：在测试用例中定义或提取的变量<br />
<strong>使用</strong>：需要 <code>$</code> 前缀或引号</p>
<div class="codehilite"><pre><span></span><code><span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">expected_status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span>
<span class="w">  </span><span class="nt">expected_token_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>

<span class="nt">extract</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.token</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">user_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.user.id</span>

<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ❌ 错误：自定义变量不能直接使用</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert token == &quot;xxx&quot;</span><span class="w">              </span><span class="c1"># NameError</span>

<span class="w">  </span><span class="c1"># ✅ 正确：需要引号和 $ 前缀</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;$token&quot; is not None</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(&quot;$token&quot;) == 16</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(&quot;$token&quot;) == $expected_token_length</span>

<span class="w">  </span><span class="c1"># ✅ 正确：在函数中引用</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${validate_token($token)}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${check_user_id($user_id)}</span>
</code></pre></div>

<h3 id="_24">混合使用<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">expected_code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="nt">extract</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">content.token</span>

<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 全局变量</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code == 200</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.code == $expected_code</span>

<span class="w">  </span><span class="c1"># 自定义变量（在函数中）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${validate_token($token)}</span>

<span class="w">  </span><span class="c1"># 全局变量链式取值</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user.name is not None</span>
</code></pre></div>

<h2 id="_25">常见使用场景<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h2>
<h3 id="1">场景 1：基础响应校验<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 状态码校验</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code == 200</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert ok is True</span>

<span class="w">  </span><span class="c1"># 响应头校验</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers[&quot;Content-Type&quot;] == &quot;application/json&quot;</span>

<span class="w">  </span><span class="c1"># 响应体校验</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.code == 0</span>
</code></pre></div>

<h3 id="2">场景 2：性能监控<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 响应时间监控</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">response_time = elapsed.total_seconds</span>

<span class="w">    </span><span class="no"># 记录慢请求</span>
<span class="w">    </span><span class="no">if response_time &gt; 1.0:</span>
<span class="w">        </span><span class="no">print(f&quot;⚠️ 慢请求警告: {url}, 耗时 {response_time}秒&quot;)</span>

<span class="w">    </span><span class="no"># 断言最大响应时间</span>
<span class="w">    </span><span class="no">assert response_time &lt; 5.0, f&quot;响应超时: {response_time}秒&quot;</span>

<span class="w">    </span><span class="no"># 不同接口不同标准</span>
<span class="w">    </span><span class="no">if &quot;/api/search&quot; in url:</span>
<span class="w">        </span><span class="no">assert response_time &lt; 2.0, &quot;搜索接口响应过慢&quot;</span>
<span class="w">    </span><span class="no">else:</span>
<span class="w">        </span><span class="no">assert response_time &lt; 1.0, &quot;普通接口响应过慢&quot;</span>
</code></pre></div>

<h3 id="3">场景 3：复杂数据校验<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 用户数据完整性</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user is not None</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user.id &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(content.user.name) &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;@&quot; in content.user.email</span>

<span class="w">  </span><span class="c1"># 订单数据校验</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(content.orders) &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">for order in content.orders:</span>
<span class="w">        </span><span class="no">assert order.get(&quot;id&quot;) is not None</span>
<span class="w">        </span><span class="no">assert order.get(&quot;amount&quot;) &gt; 0</span>
<span class="w">        </span><span class="no">assert order.get(&quot;status&quot;) in [&quot;pending&quot;, &quot;paid&quot;, &quot;completed&quot;]</span>
</code></pre></div>

<h3 id="4">场景 4：条件校验<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 根据用户类型校验</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">if content.user.type == &quot;vip&quot;:</span>
<span class="w">        </span><span class="no">assert content.user.vip_level &gt; 0</span>
<span class="w">        </span><span class="no">assert content.user.vip_expires is not None</span>
<span class="w">        </span><span class="no">assert content.user.discount &gt;= 0.8</span>
<span class="w">    </span><span class="no">elif content.user.type == &quot;premium&quot;:</span>
<span class="w">        </span><span class="no">assert content.user.premium_features is not None</span>
<span class="w">        </span><span class="no">assert len(content.user.premium_features) &gt; 0</span>
<span class="w">    </span><span class="no">else:</span>
<span class="w">        </span><span class="no">assert content.user.ads_enabled is True</span>
</code></pre></div>

<h3 id="5api">场景 5：API 版本兼容<a class="headerlink" href="#5api" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 兼容多个 API 版本</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no"># v1 和 v2 API 响应结构不同</span>
<span class="w">    </span><span class="no">if &quot;v1&quot; in url:</span>
<span class="w">        </span><span class="no">assert content.data.user_info is not None</span>
<span class="w">        </span><span class="no">user = content.data.user_info</span>
<span class="w">    </span><span class="no">elif &quot;v2&quot; in url:</span>
<span class="w">        </span><span class="no">assert content.user is not None</span>
<span class="w">        </span><span class="no">user = content.user</span>
<span class="w">    </span><span class="no">else:</span>
<span class="w">        </span><span class="no">raise ValueError(f&quot;Unknown API version in URL: {url}&quot;)</span>

<span class="w">    </span><span class="no"># 通用校验</span>
<span class="w">    </span><span class="no">assert user.id &gt; 0</span>
<span class="w">    </span><span class="no">assert user.name is not None</span>
</code></pre></div>

<h2 id="_26">最佳实践<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h2>
<h3 id="1-content">1. 优先使用 <code>content</code><a class="headerlink" href="#1-content" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ 推荐：使用 content</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>

<span class="c1"># ⚠️ 也可以：使用 body 或 json</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert body.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert json.success is True</span>
</code></pre></div>

<h3 id="2_1">2. 链式取值前先检查存在性<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ 推荐：先检查再访问</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data is not None</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.user is not None</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.user.name == &quot;Alice&quot;</span>

<span class="c1"># ❌ 不推荐：直接深层访问</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.data.user.name == &quot;Alice&quot;</span><span class="w">  </span><span class="c1"># 可能 AttributeError</span>
</code></pre></div>

<h3 id="3_1">3. 使用有意义的错误信息<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ 推荐：提供清晰的错误信息</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert status_code == 200, f&quot;期望状态码200，实际</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">status_code</span><span class="p p-Indicator">}</span><span class="s">&quot;</span>
<span class="w">  </span><span class="s">-</span><span class="nv"> </span><span class="s">assert</span><span class="nv"> </span><span class="s">content.success</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">True,</span><span class="nv"> </span><span class="s">f&quot;</span><span class="nt">API调用失败</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">content.get(&#39;message&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;未知错误&#39;</span><span class="nv">)</span><span class="p p-Indicator">}</span><span class="s">&quot;</span>

<span class="s">#</span><span class="nv"> </span><span class="s">❌</span><span class="nv"> </span><span class="s">不推荐：没有错误信息</span>
<span class="s">script:</span>
<span class="w">  </span><span class="s">-</span><span class="nv"> </span><span class="s">assert</span><span class="nv"> </span><span class="s">status_code</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">200</span>
<span class="w">  </span><span class="s">-</span><span class="nv"> </span><span class="s">assert</span><span class="nv"> </span><span class="s">content.success</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">True</span>
</code></pre></div>

<h3 id="4_1">4. 性能校验要合理<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ 推荐：根据接口类型设置不同标准</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">rt = elapsed.total_seconds</span>
<span class="w">    </span><span class="no">if &quot;/api/search&quot; in url:</span>
<span class="w">        </span><span class="no">assert rt &lt; 2.0, f&quot;搜索接口慢: {rt}s&quot;</span>
<span class="w">    </span><span class="no">elif &quot;/api/report&quot; in url:</span>
<span class="w">        </span><span class="no">assert rt &lt; 5.0, f&quot;报表接口慢: {rt}s&quot;</span>
<span class="w">    </span><span class="no">else:</span>
<span class="w">        </span><span class="no">assert rt &lt; 1.0, f&quot;普通接口慢: {rt}s&quot;</span>

<span class="c1"># ❌ 不推荐：所有接口一刀切</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert elapsed.total_seconds &lt; 1.0</span>
</code></pre></div>

<h3 id="5">5. 变量转义谨慎使用<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># ✅ 只在需要时使用转义</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 正常情况：直接使用全局变量</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>

<span class="w">  </span><span class="c1"># 特殊情况：字段名与全局变量冲突时才转义</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${check_field_exists(data, \content)}</span>

<span class="c1"># ❌ 不要过度使用转义</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${some_function(\status_code, \headers, \content)}</span><span class="w">  </span><span class="c1"># 通常不需要</span>
</code></pre></div>

<h2 id="_27">常见问题<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h2>
<h3 id="q1-contentfield-contentfield">Q1: 为什么 <code>content.field</code> 和 <code>content["field"]</code> 都可以？<a class="headerlink" href="#q1-contentfield-contentfield" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> ApiMeter 使用了 <code>ResponseFieldProxy</code> 类，支持两种访问方式：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 点号访问（推荐，更简洁）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.user.name == &quot;Alice&quot;</span>

<span class="w">  </span><span class="c1"># 字典访问（字段名包含特殊字符时使用）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content[&quot;user-name&quot;] == &quot;Alice&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content[&quot;content-type&quot;] == &quot;json&quot;</span>
</code></pre></div>

<h3 id="q2">Q2: 如何访问字段名包含点号或特殊字符的字段？<a class="headerlink" href="#q2" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> 使用字典访问方式：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 字段名: &quot;user.name&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content[&quot;user.name&quot;] == &quot;Alice&quot;</span>

<span class="w">  </span><span class="c1"># 字段名: &quot;content-type&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert headers[&quot;content-type&quot;] == &quot;application/json&quot;</span>
</code></pre></div>

<h3 id="q3-contentbodyjson">Q3: <code>content</code>、<code>body</code>、<code>json</code> 有什么区别？<a class="headerlink" href="#q3-contentbodyjson" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> 它们在 ApiMeter 中完全等价，都指向解析后的响应体：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 三者完全等价</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert body.success is True</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert json.success is True</span>
</code></pre></div>

<p><strong>建议</strong>：统一使用 <code>content</code>，保持代码风格一致。</p>
<h3 id="q4-json">Q4: 如何处理响应不是 JSON 格式的情况？<a class="headerlink" href="#q4-json" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> 使用 <code>text</code> 变量：</p>
<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># HTML 响应</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;&lt;html&quot; in text</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;&lt;/body&gt;&quot; in text</span>

<span class="w">  </span><span class="c1"># XML 响应</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;&lt;?xml&quot; in text</span>

<span class="w">  </span><span class="c1"># 纯文本响应</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert len(text) &gt; 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert &quot;success&quot; in text.lower()</span>
</code></pre></div>

<h3 id="q5-validate">Q5: 全局变量在 <code>validate</code> 中可以使用吗？<a class="headerlink" href="#q5-validate" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> 不可以。全局变量只能在 <code>script</code> 中使用：</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ❌ validate 中不支持</span>
<span class="nt">validate</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">content.success</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">]</span><span class="w">      </span><span class="c1"># 会被当作字符串</span>

<span class="c1"># ✅ script 中支持</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assert content.success is True</span>
</code></pre></div>

<h3 id="q6">Q6: 如何在自定义函数中使用全局变量？<a class="headerlink" href="#q6" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> 作为参数传递：</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># debugtalk.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_function</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">content_data</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">content_data</span><span class="o">.</span><span class="n">success</span> <span class="ow">is</span> <span class="kc">True</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 传递全局变量作为参数</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${my_function(status_code, content)}</span>
</code></pre></div>

<h2 id="_28">📝 总结<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h2>
<p>ApiMeter 的全局变量系统让响应数据访问变得简单直观：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>最常用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>status_code</code></td>
<td>int</td>
<td>状态码校验</td>
</tr>
<tr>
<td><code>content</code></td>
<td>dict-like</td>
<td>响应体数据校验（最常用）</td>
</tr>
<tr>
<td><code>headers</code></td>
<td>dict-like</td>
<td>响应头校验</td>
</tr>
<tr>
<td><code>cookies</code></td>
<td>dict-like</td>
<td>Cookie 校验</td>
</tr>
<tr>
<td><code>elapsed</code></td>
<td>timedelta</td>
<td>性能监控</td>
</tr>
<tr>
<td><code>ok</code></td>
<td>bool</td>
<td>请求成功判断</td>
</tr>
<tr>
<td><code>url</code></td>
<td>str</td>
<td>URL 校验</td>
</tr>
</tbody>
</table>
<p><strong>核心优势：</strong>
- ✅ 直接使用，无需前缀
- ✅ 支持链式取值
- ✅ 支持变量转义
- ✅ 类型安全的代理访问</p>
<p><strong>下一步学习：</strong>
- <a href="../../prepare/script/">自定义脚本校验详解</a>
- <a href="../advanced-functions/">自定义函数高级用法</a>
- <a href="../../examples/advanced-examples/">高级用法示例</a></p>
<hr />
<p><strong>有问题？</strong> 查看 <a href="../../FAQ/">FAQ</a> 或 <a href="https://git.umlife.net/utils/apimeter/issues">提交 Issue</a></p>
                
                  
                
              

<!-- AI助手浮窗脚本 -->
<script
async
defer
src="https://view.umlife.net/chat/api/embed?protocol=https&host=view.umlife.net&token=1d8f7ca0d76e223f">
</script>


              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 - 2025 debugtalk
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://git.umlife.net/utils/apimeter" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://git.umlife.net/utils/apimeter" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a353778b.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.6.1",url:{base:"../.."}})</script>
      
        <script src="../../js/slardar.js"></script>
      
    
  </body>
</html>